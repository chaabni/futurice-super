<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/font-roboto/roboto.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/core-icons/core-icons.html">

<polymer-element name="x-project-card" attributes="project">
  <template>
    <style>
      :host {
        display: block;
        position: relative;
        width: 100%;
      }
      .card {
        padding: 10px;
        overflow: visible;
        display: flex;
      }
      .card-inner {
        flex: 1;
        background-color: #fff;
        padding: 10px;
        position: relative;
        box-shadow: 0px 2px 5px rgba(0,0,0, .3);
      }
      paper-icon-button {
        fill: #e0e0e0;
      }
      :host([favorite]) paper-icon-button {
        fill: #da4336;
      }

      .align-right {
        text-align: right;
      }

      h1 {
        margin: 0 0 15px 0;
      }

      h2 {
        margin: 0;
      }

      #probability {
        font-size: 2em;
      }

      #amount {
        font-size: 1.5em;
      }

      #description {
        margin: 10px 0;
      }

      #modified {
        font-size: 0.7em;
      }

    </style>
    <div class="card">
      <div class="card-inner" vertical layout>

        <!-- Title bar-->
        <div layout horizontal>
          <h1 class="project-title" flex>{{ project.value.Name }}</h1>
          <paper-icon-button id="favorite" icon="favorite" on-tap="{{ favoriteTapped }}"></paper-icon-button>
        </div>

        <!-- 2nd title bar -->
        <div horizontal layout justified start>
          <h2>{{ project.value.Account.Name }}</h2>
          <div  class="align-right" vertical layout>
            <h2>{{ project.value.Owner.Name }}</h2>
            <div>{{ project.value.Futu_Team__c }}</div>
          </div>
        </div>

        <!-- Opportunity section  -->
        <div horizontal layout justified>
          <div vertical layout>
            <div>Stage: {{ stage }}</div>
            <div hidden?="{{ project.value.IsClosed }}">DL: {{ project.value.CloseDate }}</div>
          </div>
          <div  class="align-right" vertical layout>
            <span id="probability">{{ project.value.Probability }} %</span>
            <span id="amount">{{ project.value.Amount }} â‚¬</span>
          </div>
        </div>

        <!-- Project section -->
        <div horizontal layout>
          <div vertical layout flex>
            <div horizontal layout hidden?="{{ hideEvent }}">
              <core-icon icon="event"></core-icon>
              <span>{{ project.value.Budgeted_Work_Start_Date__c || "TBD" }} - {{ project.value.Budgeted_Work_End_Date__c || "TBD" }}</span>
            </div>
            <div id="description" class="project-description">{{ project.value.Description }}</div>
            <div id="modified" horizontal layout>
              <div>Modified: {{ modified }}</div>
            </div>
          </div>
        </div>



      </div>
    </div>
  </template>
  <script src="../../bower_components/moment/moment.js"></script>
  <script>
    Polymer('x-project-card', {
      project: {},
      publish: {
        favorite: {
          value: false,
          reflect: true
        }
      },
      status: "",
      hideEvent: true,
      favoriteTapped: function(event, detail, sender) {
        this.project.favorite = this.favorite = !this.favorite;
        this.fire('favorite-tap');
      },
      ready: function(){
        if (this.project.value.IsClosed) {
          if (this.project.value.IsWon) {
            this.stage = "Won";
          } else {
            this.stage = "Lost";
          }
        } else {
          this.stage = this.project.value.StageName;
        }

        // Hide dates if not available
        if (this.project.value.Budgeted_Work_Start_Date__c !== null || this.project.value.Budgeted_Work_End_Date__c !== null ) {
          this.hideEvent = false;
        }

        // Modified date
        this.modified = moment(this.project.value.LastModifiedDate).fromNow();
      }
    });
  </script>
</polymer-element>