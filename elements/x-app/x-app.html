<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/font-roboto/roboto.html">
<link rel="import" href="/bower_components/core-scaffold/core-scaffold.html">
<link rel="import" href="/bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="/bower_components/core-menu/core-menu.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">

<script src="/bower_components/underscore/underscore.js"></script>

<link rel="import" href="/elements/x-project-service/x-project-service.html">
<link rel="import" href="/elements/x-tribe-service/x-tribe-service.html">
<link rel="import" href="/elements/x-project-card/x-project-card.html">

<polymer-element name="x-app">
  <template>
    <style>
      /*
      Colors
      ========================================


      Primary color: Light Green
        500   #8bc34a
      Variant hues:
        100   #dcedc8
        700   #689f38

      Accent: Amber
        A100  #ffe57f
        A400  #ffc400


      http://www.google.com/design/spec/style/color.html#color-ui-color-palette
      */

      :host {
        display: block;
      }

      core-scaffold {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }

      /* Main view's header bar */
      core-scaffold /deep/ core-toolbar {
        background-color: #689f38;
        color: #fff;
      }

      /* Main view's background */
      core-scaffold /deep/ [main] {
        background-color: #fafafa;
      }

      /* Menu panel's header bar */
      .panel--menu /deep/ core-toolbar {
        background-color: #8bc34a;
      }

      /* Menu panel's background */
      .panel--menu {
        background-color: #fff;
      }


      .card-grid {
        display: flex;
        flex-wrap: wrap;
      }
    </style>

    <core-scaffold>


      <core-header-panel class="panel--menu" navigation flex mode="waterfall">
        <core-toolbar >SUPER</core-toolbar>
        <core-menu theme="core-light-theme">
          <paper-item label="All" on-tap="{{ selectAllTribes }}"></paper-item>
          <template repeat="{{ tribe in tribes }}">
            <paper-item label="{{ tribe }}" on-tap="{{ selectTribe }}"></paper-item>
          </template>
        </core-menu>
      </core-header-panel>

      <div tool>{{ tribe.name }}</div>

      <x-tribe-service id="tribe-service" tribes="{{ tribes }}"></x-tribe-service>
      <x-project-service id="service" projects="{{ projects }}"></x-project-service>

      <section class="card-grid">
        <template repeat="{{ project in projects }}">
          <x-project-card
            project="{{ project }}"
            on-favorite-tap="{{ handleFavorite }}"
            hidden?="{{ tribe.name !== defaultTribeName &amp;&amp; project.value.Futu_Team__c !== tribe.name }}"></x-project-card>
        </template>
      </section>

    </core-scaffold>
  </template>
  <script>
  Polymer('x-app', {
    handleFavorite: function(event, detail, sender) {
      var project = sender.templateInstance.model.project;
      this.$.service.setFavorite(project.id, project.favorite);
    },
    defaultTribeName: '',
    tribe: {
      name: '',
      isHidden: function(){}
    },
    selectTribe: function(event, detail, sender) {
      var name = sender.templateInstance.model.tribe;
      this.selectTribeByName(name);
    },
    selectAllTribes: function() {
      this.selectTribeByName(this.defaultTribeName);
    },
    selectTribeByName: function(name) {
      this.tribe.name = name;
      console.log("Selected tribe: " + this.tribe.name);
    },
    ready: function(){
      this.tribe.name = this.defaultTribeName = 'All';
      this.tribe.isHidden = function(event, detail, sender){
        return !(this.tribe.name === this.defaultTribeName ||
          sender.templateInstance.model.project.value.Futu_Team__c === this.tribe.name);
      }
    }
  });
  </script>
</polymer-element>
